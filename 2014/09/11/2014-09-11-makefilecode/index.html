<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
    <meta name="google-site-verification" content="SiLo1Ls2eD6kYCAXC6oL8UkPQyLK8DDi8__7s5cwM5E" />
    <meta name="google-site-verification" content="SwHhCod35NS9WsOn__NrOBkyiReSqd6zrop63nGfC4Q" />
    <meta name="baidu-site-verification" content="exj9fuGP3J" />
    <meta name="baidu-site-verification" content="KKwKp3rnOw" />
    <meta name="baidu-site-verification" content="MEbfiyjHYX" />
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/cloud.ico?v=5.1.0" />






<meta name="description" content="今天逛 @杨万荣 网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。原文地址:http://sndnvaps.github.io/
这些变量，你会经常在Android.mk文件中见到，下面以字表表的顺序列出来，并进行一一讲解其作用。

LOCAL_

这个变量会在每个模块(module,也可以解释为程序). 当出现 include $(CLEAR_VARS)变量的时候，它们">
<meta property="og:type" content="article">
<meta property="og:title" content="Android.mk 变量讲解">
<meta property="og:url" content="http://percychen.com/2014/09/11/2014-09-11-makefilecode/index.html">
<meta property="og:site_name" content="风之子的世界">
<meta property="og:description" content="今天逛 @杨万荣 网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。原文地址:http://sndnvaps.github.io/
这些变量，你会经常在Android.mk文件中见到，下面以字表表的顺序列出来，并进行一一讲解其作用。

LOCAL_

这个变量会在每个模块(module,也可以解释为程序). 当出现 include $(CLEAR_VARS)变量的时候，它们">
<meta property="og:updated_time" content="2017-01-17T07:08:05.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android.mk 变量讲解">
<meta name="twitter:description" content="今天逛 @杨万荣 网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。原文地址:http://sndnvaps.github.io/
这些变量，你会经常在Android.mk文件中见到，下面以字表表的顺序列出来，并进行一一讲解其作用。

LOCAL_

这个变量会在每个模块(module,也可以解释为程序). 当出现 include $(CLEAR_VARS)变量的时候，它们">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '8780122',
      author: '振云'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://percychen.com/2014/09/11/2014-09-11-makefilecode/"/>





  <title> Android.mk 变量讲解 | 风之子的世界 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=58976570";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">风之子的世界</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://percychen.com/2014/09/11/2014-09-11-makefilecode/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="percy|振云">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/yunicon.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="风之子的世界">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="风之子的世界" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android.mk 变量讲解
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-09-11T13:14:00+08:00">
                2014-09-11
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
              <time title="更新于" itemprop="dateModified" datetime="2017-01-17T15:08:05+08:00">
                2017-01-17
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/09/11/2014-09-11-makefilecode/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/09/11/2014-09-11-makefilecode/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2014/09/11/2014-09-11-makefilecode/" class="leancloud_visitors" data-flag-title="Android.mk 变量讲解">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="今天逛-杨万荣-网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。"><a href="#今天逛-杨万荣-网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。" class="headerlink" title="今天逛 @杨万荣 网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。"></a>今天逛 @杨万荣 网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。</h4><p><a href="http://sndnvaps.github.io/" target="_blank" rel="external">原文地址:http://sndnvaps.github.io/</a></p>
<p>这些变量，你会经常在Android.mk文件中见到，下面以字表表的顺序列出来，并进行一一讲解其作用。<br></p>
<ul>
<li>LOCAL_</li>
</ul>
<p>这个变量会在每个模块(module,也可以解释为程序). 当出现 include $(CLEAR_VARS)变量的时候，它们当初设置的变量，会清空。在你使用的大部分变量中，它存在于模块中的定义都会像 LOCAL_variables(variables 为变量的名字)<br></p>
<ul>
<li>PRIVATE_</li>
</ul>
<p>这个是定义私有的变量。 只有有特别的模块中，这个变量才有起效。<br><br>HOST<em> 和 TARGET</em>    定义编译生成的文件是运行在什么平台的。<br><br>不要随便使用 HOST<em> 或者是 TARGET</em> 变量在你的makefile(对应的文件是Android.mk文件）文件中。<br></p>
<ul>
<li>BUILD_ 和 CLEAR_VARS</li>
</ul>
<p>变量 ， 它们是已经预先定义的模块makefile文件。<br>下面提供一个简单的例子: CLEAR_VARS 和 BUILD_HOST_PACKAGE</p>
<h2 id="—————————————-正式讲解———————–"><a href="#—————————————-正式讲解———————–" class="headerlink" title="—————————————-正式讲解———————–"></a>—————————————-正式讲解———————–</h2><ul>
<li>LOCAL_ARM_MODE</li>
</ul>
<p>ARM使用的模式</p>
<ul>
<li>LOCAL_ASSERT_FILES</li>
</ul>
<p>Android.mk中定义的模块需要包含 ‘include $(BUILD_PACKAGE)’ ，一般形式:</p>
<pre><code>LOCAL_ASSET_FILES += $(call find-subdir-assets)
</code></pre><ul>
<li>LOCAL_C_INCLUDES</li>
</ul>
<p>当编译C/C++文件的时候，这个变量指定的路径是用于编译器查找头文件的。例子:</p>
<pre><code>LOCAL_C_INCLUDES += extlibs/zlib-1.2.3
</code></pre><ul>
<li>LOCAL_CC</li>
</ul>
<p>如果你想使用第三方的C编译器，编译当前的程    序。就用LOCAL_CC设置第三方编译的位置</p>
<ul>
<li>LOCAL_CERTIFICATE</li>
</ul>
<p>签名用的证书的名字 ，也可以用于指明特别的签名证书(例如自己创建的证书)</p>
<ul>
<li>LOCAL_CFLAGS</li>
</ul>
<p>如果需要给C/C++编译传递自己的参数，那么你就需要这个变量了。例子:</p>
<pre><code>LOCAL_CFLAGS += -DLIBBUILTS_NATIVE=1
</code></pre><ul>
<li>LOCAL_COPY_HEADERS</li>
</ul>
<p>用于复制头文件，需要和LOCAL_COPY_HEADRES_TO 变量一起使用</p>
<ul>
<li>LOCAL_COPY_HEADERS_TO</li>
</ul>
<p>需要和LOCAL_COPY_HEADERS 变量一起使用，用于复制头文件</p>
<ul>
<li>LOCAL_CPP_EXTENSION</li>
</ul>
<p>如果你的C++文件的后序不是cpp,而是其它的，你就需要用这个变量定义一下了。例子:</p>
<pre><code>LOCAL_CPP_EXTENSION := .cc
</code></pre><ul>
<li>LOCAL_CPPFLAGS</li>
</ul>
<p>这个用于传递编译指令到唯一的C++编译器中。例子:</p>
<pre><code>LOCAL_CPPFLAGS += -ffriend-injection
</code></pre><ul>
<li>LOCAL_CPPFLAGS</li>
</ul>
<p>在编译器接收的指令中，迟于LOCAL_CFLAGS ,所以你可以用它来覆盖LOCAL_CFLAGS定义的指令</p>
<ul>
<li>LOCAL_CXX</li>
</ul>
<p>如果你想用第三方的C++编译器，编译当前的程序或者是模块，你可以使用这个变量，和变量LOCAL_CC的使用方法一样。</p>
<ul>
<li>LOCAL_FORCE_STATIC_EXECUTABLE</li>
</ul>
<p>如果你编译的程序，需要被链接成静态文件，不包含动态链接，作如下的设置:</p>
<pre><code>LOCAL_FORCE_STATIC_EXECUTABLE := true 。
</code></pre><p>这样编译出来的程序可以在没有动态库支持的根目录下面运行。</p>
<ul>
<li>LOCAL_GENERATED_SOURCES</li>
</ul>
<p>后面的定义的变量，会被自动转换成你所需要的文件的格式</p>
<ul>
<li>LOCAL_JAR_MANIFEST</li>
</ul>
<p>定义jar文件需要用到的manifest文件</p>
<ul>
<li>LOCAL_JAVA_LIBRARIES</li>
</ul>
<p>当编译生成java程序或者是库文件的时候，LOCAL_JAVA_LIBRARIES, 定义的是要被编译成程序或者是库的文件。下面来一个简单的例子，需要链接的库文件为core 和 framework.</p>
<pre><code>LOCAL_JAVA_LIBRARIES := core framework
</code></pre><p>注意: 在Android.mk的模块中设置 LOCAL_JAVA_LIBRARIE ，一般不需要(或者不允许)当编译一个APK 程序，模块中包含了 “include $(BUILD_PACKAGE)”。 那么这些必要的核心文件会自动包含进去。</p>
<ul>
<li>LOCAL_LDFLAGS</li>
</ul>
<p>你可以往链接器(linker)传递一些自己的指令，通过设置 “LOCAL_LDFLAGS”。不过要时刻记住，传递到链接器的参数是非常重要的，必须要事件进行一些测试。</p>
<ul>
<li>LOCAL_LDLIBS</li>
</ul>
<p>用于指定一些第三方的动态库或者是静态库文件，需要用-lxxx格式，这些文件不在你的编译计划中。例子:</p>
<pre><code>LOCAL_LDLIBS += -lcurses -lpthread
LOCAL_LDLIBS += -Wl, -z,origin
</code></pre><ul>
<li>LOCAL_MODULE</li>
</ul>
<p>“LOCAL_MODULE” 是一个你定义在Android.mk文件中的一个程序的名字。例如，库文件”libkjs”, 相应的对应为: LOCAL_MODULE 是 “libkjs”(编译的平台会自动给它加上后序，例如 .so, .dylib, .dll)。对于 APK程序，将会使用LOCAL_PACKAGE_NAME 而不是 LOCAL_MODULE</p>
<ul>
<li>LOCAL_MODULE_PATH</li>
</ul>
<p>告诉编译平台，如何把编译出来的程序或者是模块放到特定的位置。如果你需要定义这个变量，确保你同时定义了”LOCAL_UNSTRIPPED_PATH” 如果你编译生成的文件是可执行文件或者是动态库，这样就可以确保没有去符号(unstripped)链接的二进制文件有位置可去了。如果你没有进行定义，就有可能发生错误————–</p>
<ul>
<li>LOCAL_MODULE_TAGS</li>
</ul>
<p>用于指定生成的程序是什么类型的。有以下的几个变量：</p>
<pre><code>user: 将会使用 user/userdebug模式去编译程序
eng:  将会使用 eng模式去编译程序
tests: 将会使用testing模式编译程序
optional: 不建议使用这个模式
</code></pre><ul>
<li>LOCAL_PACKAGE_NAME</li>
</ul>
<p>用于设置APK程序的名字，例如: Dialer, Contacts</p>
<ul>
<li>LOCAL_POST_PROCESS_COMMAND</li>
</ul>
<p>用于生成本机的可执行文件，当程序被编译好后，你可以给它传递一条命令。下面是例子:</p>
<pre><code>module := $(HOST_OUT_EXECUTABLES)/$(LOCAL_MODULE)
LOCAL_POST_PROCESS_COMMAND := /Developer/Tools/Rez -d __DARWIN__ -t APPL\
-d __WXMAC__ -o $(module) Carbon.r
</code></pre><ul>
<li>LOCAL_PREBUILT_EXECUTABLES</li>
</ul>
<p>当Android.mk文件中包含 $(BUILD_PREBUILT) 或者是 $(BUILD_HOST_PREBUILT), 你可以使用这个变量去定义，你要复制到哪个目录。这样它就可以自动被复制到特定的目录了。</p>
<ul>
<li>LOCAL_PREBUILT_LIBS</li>
</ul>
<p>解释和LOCAL_PREBUILT_EXECUTABLES 一样。</p>
<ul>
<li>LOCAL_REQUIRED_MODULES</li>
</ul>
<p>不知道怎样解释，直接上英文:</p>
<pre><code>Set LOCAL_REQUIRED_MODULES to any number of whitespace-separated module names, like &quot;libblah&quot; or &quot;Email&quot;. If this module is installed, all of the modules that it requires will be installed as well. This can be used to, e.g., ensure that necessary shared libraries or providers are installed when a given app is installed.
</code></pre><ul>
<li>LOCAL_SDK_VERSION</li>
</ul>
<p>设置本地的sdk版本号</p>
<ul>
<li>LOCAL_SHARED_LIBRARIES</li>
</ul>
<p>定义的内容为要链接的动态库的名字，不需要后序。例子:</p>
<pre><code>LOCAL_SHARED_LIBRARIES := \
    libutils \
    libui \
    libaudio \
    libexpat \
    libsgl
</code></pre><ul>
<li>LOCAL_SRC_FILES</li>
</ul>
<p>编译系统会查找 定义在LOCAL_SRC_FILES后面的值，去查找需要编译的源代码，例如 <em>.c, </em>.cpp, <em>.y, </em>.l, *.java。对于lex 和 yacc文件，需要定义一下传递的指令。如果是C/cpp，它会自动处理。如果包含的文件在二级目录下面，也可以直接进行定义。例子:</p>
<pre><code>LOCAL_SRC_FILES := \
file1.cpp \
dir/file2.cpp
</code></pre><ul>
<li>LOCAL_STATIC_LIBRARIES</li>
</ul>
<p>解释和LOCAL_SHARED_LIBRARIES大致一样。不过这次要链接的是静态库文件。</p>
<ul>
<li>LOCAL_UNSTRIPPED_PATH</li>
</ul>
<p>定义放置没有去符号链接的文件的位置，如果你同时定义了LOCAL_MODULE_PATH ,而编译的程序是可执行程序或者是动态库文件。那么出现错误是在所难免的。</p>
<ul>
<li>LOCAL_WHOLE_STATIC_LIBRARIES</li>
</ul>
<p>用于把静态库链接到程序中，而不允许链接器去掉其中没有用的符号链接。如果你想把静态库编译进动态库中，而在静态库中已经包含了动态库中的符号链接，这个时候就特别有用了。<br>例子:</p>
<pre><code>LOCAL_WHOLE_STATIC_LIBRARIES := \libsqlite3_android
</code></pre><ul>
<li>LOCAL_YACCFLAGS</li>
</ul>
<p>用于把编译指令传递给yacc模块。例子:</p>
<pre><code>LOCAL_YACCFLAGS := -p kjsyy
</code></pre>
      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/09/11/2014-09-11-sublimetextkey/" rel="next" title="sublime_text 常用快捷键">
                <i class="fa fa-chevron-left"></i> sublime_text 常用快捷键
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2014/09/11/2014-09-11-romerlinks/" rel="prev" title="Android ROM大神的友情链接">
                Android ROM大神的友情链接 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2014/09/11/2014-09-11-makefilecode/"
     data-title="Android.mk 变量讲解"
     data-content=""
     data-url="http://percychen.com/2014/09/11/2014-09-11-makefilecode/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>

          
          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2014/09/11/2014-09-11-makefilecode/"
           data-title="Android.mk 变量讲解" data-url="http://percychen.com/2014/09/11/2014-09-11-makefilecode/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/yunicon.png"
               alt="percy|振云" />
          <p class="site-author-name" itemprop="name">percy|振云</p>
          <p class="site-description motion-element" itemprop="description">我歌我且笑，岁月共此生</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">150</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/yunpercy" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/yun-percy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://user.qzone.qq.com/464095417" target="_blank" title="QQ空间">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  QQ空间
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://xiangsunzi.com/" title="生活与小怪兽" target="_blank">生活与小怪兽</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#今天逛-杨万荣-网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。"><span class="nav-number">1.</span> <span class="nav-text">今天逛 @杨万荣 网站看到的。访问太慢，就直接clone文章，重新用markdown排了版。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#—————————————-正式讲解———————–"><span class="nav-number"></span> <span class="nav-text">—————————————-正式讲解———————–</span></a></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">percy|振云</span>
</div>


<div class="powered-by">
  由 percy 先生维护制作
</div>

<div class="theme-info">
  关于 -
  <a class="theme-link" href="http://percychen.com/about/">
    percy先生
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"percychen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js?v=5.1.0"></script>
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  












  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("7d74DeOPOEXkqoHL2A6jD1Ov-gzGzoHsz", "UU5DcLV69esGTGlJCglVXSiE");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
  


</body>
</html>
