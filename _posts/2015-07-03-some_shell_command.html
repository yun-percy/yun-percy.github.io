---
layout: post
title: 一堆shell脚本技巧
category: shell
tags : [ linux,shell,脚本]
---

<p>本文为转载：</p>
<a href="http://mingxinglai.com/cn/2013/01/skills-of-shell/">原帖地址</a>


<section class="post">
<p>本文收集了一堆的shell脚本技巧，我说过，我写博客主要是作一些学习笔记，方便自己查阅，所以，我会搞出这么一篇文章，也没有什么不可理解的。关于这些技巧的出处，诶，我也忘了，可能来自<a href="http://theunixschool.com">theunixschool</a>、
<a href="http://www.commandlinefu.com/commands/browse">commandlinefu</a>、<a href="http://www.kuqin.com/linux/20121018/332591.html">酷勤网</a>和<a href="http://www.igigo.net/cmd">igigo.net</a>，当然了，也有部分是我自己的经验心得，管他呢，进了我的脑子就是我的了。</p>

<h3>0. shell 调试</h3>

<ol>
<li>sh -x somefile.sh</li>
<li>在somefile.sh 文件里加上set+x set-x</li>
</ol>


<h3>1. 用 &amp;&amp; || 简化if else</h3>

<pre class="prettyprint"><code><span class="pln">gzip </span><span class="pun">-</span><span class="pln">t a</span><span class="pun">.</span><span class="pln">tar</span><span class="pun">.</span><span class="pln">gz
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">[[</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> $</span><span class="pun">?</span><span class="pln"> </span><span class="pun">]];</span><span class="pln"> </span><span class="kwd">then</span><span class="pln">
    echo </span><span class="str">"good zip"</span><span class="pln">
</span><span class="kwd">else</span><span class="pln">
    echo </span><span class="str">"bad zip"</span><span class="pln">
</span><span class="kwd">fi</span></code></pre>

<p>可以简化为：</p>

<pre class="prettyprint"><code><span class="pln">gzip  </span><span class="pun">-</span><span class="pln">t a</span><span class="pun">.</span><span class="pln">tar</span><span class="pun">.</span><span class="pln">gz </span><span class="pun">&amp;&amp;</span><span class="pln"> echo </span><span class="str">"good zip"</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> echo </span><span class="str">"bad zip"</span></code></pre>

<h3>2. 判断文件非空</h3>

<pre class="prettyprint"><code><span class="kwd">if</span><span class="pln"> </span><span class="pun">[[</span><span class="pln"> </span><span class="pun">-</span><span class="pln">s $file </span><span class="pun">]];</span><span class="pln"> </span><span class="kwd">then</span><span class="pln">
    echo </span><span class="str">"not empty"</span><span class="pln">
</span><span class="kwd">fi</span></code></pre>

<h3>3. 获取文件大小</h3>

<pre class="prettyprint"><code><span class="pln">stat </span><span class="pun">-</span><span class="pln">c </span><span class="pun">%</span><span class="pln">s $file
stat </span><span class="pun">--</span><span class="pln">printf</span><span class="pun">=</span><span class="str">'%s\n'</span><span class="pln"> $file
wc </span><span class="pun">-</span><span class="pln">c $file</span></code></pre>

<h3>4. 字符串替换</h3>

<pre class="prettyprint"><code><span class="pln">$</span><span class="pun">{</span><span class="kwd">string</span><span class="com">//pattern/replacement}</span><span class="pln">
a</span><span class="pun">=</span><span class="str">'a,b,c'</span><span class="pln">
echo $</span><span class="pun">{</span><span class="pln">a</span><span class="com">//,/ /}</span></code></pre>

<h3>5. Contains 子字符串？</h3>

<pre class="prettyprint"><code><span class="kwd">string</span><span class="pun">=</span><span class="str">"My string"</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">[[</span><span class="pln"> $string </span><span class="pun">==</span><span class="pln"> </span><span class="pun">*</span><span class="typ">My</span><span class="pun">*</span><span class="pln"> </span><span class="pun">]];</span><span class="pln"> </span><span class="kwd">then</span><span class="pln">
    echo </span><span class="str">"It's there!"</span><span class="pln">
</span><span class="kwd">fi</span></code></pre>

<h3>6. 备份</h3>

<pre class="prettyprint"><code><span class="pln">rsync </span><span class="pun">-</span><span class="pln">r </span><span class="pun">-</span><span class="pln">t </span><span class="pun">-</span><span class="pln">v </span><span class="pun">/</span><span class="pln">source_folder </span><span class="pun">/</span><span class="pln">destination_folder
rsync </span><span class="pun">-</span><span class="pln">r </span><span class="pun">-</span><span class="pln">t </span><span class="pun">-</span><span class="pln">v </span><span class="pun">/</span><span class="pln">source_folder </span><span class="pun">[</span><span class="pln">user@host</span><span class="pun">:/</span><span class="pln">destination_folder</span></code></pre>

<h3>7. 批量重命名文件</h3>

<ul>
<li><p>为所有txt文件加上.bak 后缀：</p>

<pre class="prettyprint"><code><span class="pln">  rename </span><span class="str">'.txt'</span><span class="pln"> </span><span class="str">'.txt.bak'</span><span class="pln"> </span><span class="pun">*.</span><span class="pln">txt</span></code></pre></li>
<li><p>去掉所有的bak后缀</p>

<pre class="prettyprint"><code><span class="pln">  rename </span><span class="str">'*.bak'</span><span class="pln"> </span><span class="str">''</span><span class="pln"> </span><span class="pun">*.</span><span class="pln">bak</span></code></pre></li>
<li><p>把所有的空格改成下划线</p>

<pre class="prettyprint"><code><span class="pln">  find path </span><span class="pun">-</span><span class="pln">type f </span><span class="pun">-</span><span class="kwd">exec</span><span class="pln"> rename </span><span class="str">'s/ /_/g'</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"> \;</span></code></pre></li>
<li><p>把文件名都改成大写</p>

<pre class="prettyprint"><code><span class="pln">  find path </span><span class="pun">-</span><span class="pln">type f </span><span class="pun">-</span><span class="kwd">exec</span><span class="pln"> rename </span><span class="str">'y/a-z/A-Z/'</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"> \;</span></code></pre></li>
</ul>


<h3>8. for/while 循环</h3>

<pre class="prettyprint"><code><span class="kwd">for</span><span class="pln"> </span><span class="pun">((</span><span class="pln">i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++));</span><span class="pln"> </span><span class="kwd">do</span><span class="pln"> echo $i</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">done</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> line </span><span class="kwd">in</span><span class="pln"> $</span><span class="pun">(</span><span class="pln">cat a</span><span class="pun">.</span><span class="pln">txt</span><span class="pun">);</span><span class="pln"> </span><span class="kwd">do</span><span class="pln"> echo $line</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">done</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> f </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">*.</span><span class="pln">txt</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">do</span><span class="pln"> echo $f</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">done</span><span class="pln">
</span><span class="kwd">while</span><span class="pln"> read line </span><span class="pun">;</span><span class="pln"> </span><span class="kwd">do</span><span class="pln"> echo $line</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">txt
cat a</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">|</span><span class="pln"> </span><span class="kwd">while</span><span class="pln"> read line</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">do</span><span class="pln"> echo $line</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">done</span></code></pre>

<h3>9. 删除空行</h3>

<pre class="prettyprint"><code><span class="pln">cat a</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">|</span><span class="pln"> sed </span><span class="pun">-</span><span class="pln">e </span><span class="str">'/^$/d'</span><span class="pln">
</span><span class="pun">(</span><span class="pln">echo </span><span class="str">"abc"</span><span class="pun">;</span><span class="pln"> echo </span><span class="str">""</span><span class="pun">;</span><span class="pln"> echo </span><span class="str">"ddd"</span><span class="pun">;)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> awk </span><span class="str">'{if (0 != NF) print $0;}'</span></code></pre>

<h3>10. 比较文件的修改时间</h3>

<pre class="prettyprint"><code><span class="pun">[[</span><span class="pln"> file1</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">-</span><span class="pln">nt file2</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">]]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> echo </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> echo </span><span class="kwd">false</span><span class="pln">
</span><span class="pun">[[</span><span class="pln"> file1</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">-</span><span class="pln">ot file2</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">]]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> echo </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> echo </span><span class="kwd">false</span></code></pre>

<h3>11. 实现Dictionary结构</h3>

<pre class="prettyprint"><code><span class="pln">hput</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">eval</span><span class="pln"> </span><span class="str">"hkey_$1"</span><span class="pun">=</span><span class="str">"$2"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
hget</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">eval</span><span class="pln"> echo </span><span class="str">'${'"hkey_$1"'}'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
$ hput k1 aaa
$ hget k1
aaa</span></code></pre>

<h3>12. 去掉第二列</h3>

<pre class="prettyprint"><code><span class="pln">$echo </span><span class="str">'a b c d e f'</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> cut </span><span class="pun">-</span><span class="pln">d </span><span class="str">' '</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f1</span><span class="pun">,</span><span class="lit">3</span><span class="pun">-</span><span class="pln">
$a c d e f</span></code></pre>

<h3>13. 把stderr输出保存到变量</h3>

<pre class="prettyprint"><code><span class="pln">$ a</span><span class="pun">=</span><span class="pln">$</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="pln">echo </span><span class="str">'out'</span><span class="pun">;</span><span class="pln"> echo </span><span class="str">'error'</span><span class="pln"> </span><span class="lit">1</span><span class="pun">&gt;&amp;</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="lit">2</span><span class="pun">&gt;&amp;</span><span class="lit">1</span><span class="pln"> </span><span class="lit">1</span><span class="pun">&gt;</span><span class="str">/dev/</span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
$ echo $a
error</span></code></pre>

<h3>14. 删除前3行</h3>

<pre class="prettyprint"><code><span class="pln">$cat a</span><span class="pun">.</span><span class="pln">txt </span><span class="pun">|</span><span class="pln"> sed </span><span class="lit">1</span><span class="pun">,</span><span class="lit">3d</span></code></pre>

<h3>15. 读取多个域到变量</h3>

<pre class="prettyprint"><code><span class="pln">read a b c </span><span class="pun">&lt;&lt;&lt;</span><span class="pln"> </span><span class="str">"xxx yyy zzz"</span></code></pre>

<h3>16. 遍历数组</h3>

<pre class="prettyprint"><code><span class="pln">array</span><span class="pun">=(</span><span class="pln"> one two three </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">array</span><span class="pun">[@]}</span><span class="pln">
        </span><span class="kwd">do</span><span class="pln">
echo $i
</span><span class="kwd">done</span></code></pre>

<h3>17. 查看目录大小</h3>

<pre class="prettyprint"><code><span class="pln">$ du </span><span class="pun">–</span><span class="pln">sh </span><span class="pun">~/</span><span class="pln">apps</span></code></pre>

<h3>18. 查看CPU信息</h3>

<pre class="prettyprint"><code><span class="pln">$ cat </span><span class="pun">/</span><span class="pln">proc</span><span class="pun">/</span><span class="pln">cpuinfo</span></code></pre>

<h3>19. date</h3>

<pre class="prettyprint"><code><span class="pln">$ date </span><span class="pun">+%</span><span class="pln">Y</span><span class="pun">-%</span><span class="pln">m</span><span class="pun">-%</span><span class="pln">d
</span><span class="lit">2012</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">24</span><span class="pln">
$ date </span><span class="pun">+%</span><span class="pln">Y</span><span class="pun">-%</span><span class="pln">m</span><span class="pun">-%</span><span class="pln">d </span><span class="pun">–</span><span class="pln">date </span><span class="pun">‘-</span><span class="lit">1</span><span class="pln"> day</span><span class="pun">’</span><span class="pln">
</span><span class="lit">2012</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">23</span><span class="pln">
$ date </span><span class="pun">+%</span><span class="pln">Y</span><span class="pun">-</span><span class="pln">m</span><span class="pun">-%</span><span class="pln">d </span><span class="pun">–</span><span class="pln">date </span><span class="pun">‘</span><span class="typ">Dec</span><span class="pln"> </span><span class="lit">25</span><span class="pun">’</span><span class="pln">
</span><span class="lit">2011</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">25</span><span class="pln">
$ date </span><span class="pun">+%</span><span class="pln">Y</span><span class="pun">-</span><span class="pln">m</span><span class="pun">-%</span><span class="pln">d </span><span class="pun">–</span><span class="pln">date </span><span class="pun">‘</span><span class="typ">Dec</span><span class="pln"> </span><span class="lit">25</span><span class="pln"> </span><span class="pun">–</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> days</span><span class="pun">’</span><span class="pln">
</span><span class="lit">2011</span><span class="pun">-</span><span class="lit">12</span><span class="pun">-</span><span class="lit">15</span></code></pre>

<h3>20. 获取路径名和文件名</h3>

<pre class="prettyprint"><code><span class="pln">$ dirname </span><span class="pun">‘/</span><span class="pln">home</span><span class="pun">/</span><span class="pln">lalor</span><span class="pun">/</span><span class="pln">a</span><span class="pun">.</span><span class="pln">txt</span><span class="pun">’</span><span class="pln">
</span><span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="pln">lalor
$ basename </span><span class="pun">‘/</span><span class="pln">home</span><span class="pun">/</span><span class="pln">lalor</span><span class="pun">/</span><span class="pln">a</span><span class="pun">.</span><span class="pln">txt</span><span class="pun">’</span><span class="pln">
a</span><span class="pun">.</span><span class="pln">txt</span></code></pre>

<h3>21. 并集和交集</h3>

<p>comm 可以用来求并集，交集，差集,假设现在有两个文件a和b,它们的内容如下：</p>

<pre class="prettyprint"><code><span class="pln">$cat a
</span><span class="lit">1</span><span class="pln">
</span><span class="lit">3</span><span class="pln">
</span><span class="lit">5</span><span class="pln">

$cat b
</span><span class="lit">3</span><span class="pln">
</span><span class="lit">4</span><span class="pln">
</span><span class="lit">5</span><span class="pln">
</span><span class="lit">6</span><span class="pln">
</span><span class="lit">7</span><span class="pln">

$comm a b
</span><span class="lit">1</span><span class="pln">
        </span><span class="lit">3</span><span class="pln">
    </span><span class="lit">4</span><span class="pln">
        </span><span class="lit">5</span><span class="pln">
    </span><span class="lit">6</span><span class="pln">
    </span><span class="lit">7</span><span class="pln">

$comm </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="lit">2</span><span class="pln"> a b </span><span class="com">#交集</span><span class="pln">
</span><span class="lit">3</span><span class="pln">
</span><span class="lit">5</span><span class="pln">

$comm a b </span><span class="pun">|</span><span class="pln"> sed </span><span class="str">'s/\t//g'</span><span class="pln"> </span><span class="com">#并集</span><span class="pln">
</span><span class="lit">1</span><span class="pln">
</span><span class="lit">2</span><span class="pln">
</span><span class="lit">3</span><span class="pln">
</span><span class="lit">4</span><span class="pln">
</span><span class="lit">5</span><span class="pln">
</span><span class="lit">6</span><span class="pln">
</span><span class="lit">7</span><span class="pln">

$comm </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="lit">3</span><span class="pln"> a b </span><span class="pun">|</span><span class="pln"> sed </span><span class="str">'s/\t//g'</span><span class="pln"> </span><span class="com">#b-a</span><span class="pln">
</span><span class="lit">4</span><span class="pln">
</span><span class="lit">6</span><span class="pln">
</span><span class="lit">7</span></code></pre>

<h3>22. awk复杂分隔符</h3>

<ul>
<li><p>多字符作分隔符</p>

<pre class="prettyprint"><code><span class="pln">  $ echo </span><span class="str">"a||b||c||d"</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> awk </span><span class="pun">-</span><span class="pln">F </span><span class="str">'[|][|]'</span><span class="pln"> </span><span class="str">'{print $3}'</span><span class="pln">
  c</span></code></pre></li>
<li><p>多种分隔符1</p>

<pre class="prettyprint"><code><span class="pln">  $echo </span><span class="str">"a||b,#c d"</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> awk </span><span class="pun">-</span><span class="pln">F </span><span class="str">'[| ,#]+'</span><span class="pln"> </span><span class="str">'{print $4}'</span><span class="pln">
  d</span></code></pre></li>
<li><p>多种分隔符2</p>

<pre class="prettyprint"><code><span class="pln">  $echo </span><span class="str">"a||b##c|#d"</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> awk </span><span class="pun">-</span><span class="pln">F </span><span class="str">'([|][|])|([#][#])'</span><span class="pln"> </span><span class="str">'{print $NF}'</span><span class="pln">
  c</span><span class="pun">|</span><span class="com">#d</span></code></pre></li>
</ul>


<h3>23. 产生一个随机数</h3>

<pre class="prettyprint"><code><span class="pln">echo $RANDOM</span></code></pre>

<h3>24. 按照模式split 文件</h3>

<pre class="prettyprint"><code><span class="pln">csplit server</span><span class="pun">.</span><span class="pln">log </span><span class="pun">/</span><span class="pln">PATTERN</span><span class="pun">/</span><span class="pln"> </span><span class="pun">-</span><span class="pln">n </span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln">s </span><span class="pun">{*}</span><span class="pln"> </span><span class="pun">-</span><span class="pln">f server_result </span><span class="pun">-</span><span class="pln">b </span><span class="str">"%02d.log"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">z
</span><span class="pun">/</span><span class="pln">PATTERN</span><span class="pun">/</span><span class="pln"> </span><span class="pun">用来匹配某一行，分割过程由此开始</span><span class="pln">
</span><span class="pun">{*}</span><span class="pln"> </span><span class="pun">根据匹配，重复执行分割</span><span class="pln">
</span><span class="pun">-</span><span class="pln">s </span><span class="pun">静默模式</span><span class="pln">
</span><span class="pun">-</span><span class="pln">n </span><span class="pun">分割后文件名后缀中，数字的个数</span><span class="pln">
</span><span class="pun">-</span><span class="pln">f </span><span class="pun">分割后的文件名前缀</span><span class="pln">
</span><span class="pun">-</span><span class="pln">b </span><span class="pun">指定后缀格式</span></code></pre>

<h3>25. 获取文件名或者扩展名</h3>

<pre class="prettyprint"><code><span class="kwd">var</span><span class="pun">=</span><span class="pln">hack</span><span class="pun">.</span><span class="pln">fun</span><span class="pun">.</span><span class="pln">book</span><span class="pun">.</span><span class="pln">txt
echo $</span><span class="pun">{</span><span class="kwd">var</span><span class="pun">%.*}</span><span class="pln">
hack</span><span class="pun">.</span><span class="pln">fun</span><span class="pun">.</span><span class="pln">book
echo $</span><span class="pun">{</span><span class="kwd">var</span><span class="pun">%%.*}</span><span class="pln">
hack
echo $</span><span class="pun">{</span><span class="kwd">var</span><span class="com">#.*}</span><span class="pln">
fun</span><span class="pun">.</span><span class="pln">book</span><span class="pun">.</span><span class="pln">txt
echo $</span><span class="pun">{</span><span class="kwd">var</span><span class="com">##.*}</span><span class="pln">
txt</span></code></pre>

<h3>26. 以 root 帐户执行上一条命令。</h3>

<pre class="prettyprint"><code><span class="pln">$sudo </span><span class="pun">!!</span></code></pre>

<p>其中：
* !! 是指上一条命令
* !$ 上一条命令的最后一个参数
* !* 上一条命令的所有参数
* !:3 上一条命令的第3个参数</p>

<p>例如：</p>

<pre class="prettyprint"><code><span class="pln">$ls </span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">somedir
 ls</span><span class="pun">:</span><span class="pln"> cannot access </span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">somedir</span><span class="pun">:</span><span class="pln"> </span><span class="typ">No</span><span class="pln"> such file </span><span class="kwd">or</span><span class="pln"> directory
$mkdir </span><span class="pun">!</span><span class="pln">$
 madir </span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">somedir</span></code></pre>

<h3>27. 利用 Python 搭建一个简单的 Web 服务器，可通过 http://$HOSTNAME:8000 访问。</h3>

<pre class="prettyprint"><code><span class="pln">python </span><span class="pun">-</span><span class="pln">m </span><span class="typ">SimpleHTTPServer</span></code></pre>

<h3>28. 在 Vim 中无需权限保存编辑的文件。</h3>

<pre class="prettyprint"><code><span class="pun">:</span><span class="pln">w </span><span class="pun">!</span><span class="pln">sudo tee </span><span class="pun">%</span></code></pre>

<h3>29. 将上一条命令中的 foo 替换为 bar，并执行。</h3>

<pre class="prettyprint"><code><span class="pun">^</span><span class="pln">foo</span><span class="pun">^</span><span class="pln">bar</span></code></pre>

<h3>30. 快速备份或复制文件。</h3>

<pre class="prettyprint"><code><span class="pln">cp filename</span><span class="pun">{,.</span><span class="pln">bak</span><span class="pun">}</span></code></pre>

<h3>31. 将 ssh keys 复制到 user@host 以启用无密码 SSH 登录。</h3>

<pre class="prettyprint"><code><span class="pln">$ssh</span><span class="pun">-</span><span class="pln">copy</span><span class="pun">-</span><span class="pln">id user@host</span></code></pre>

<h3>32. 把 Linux 桌面录制为视频。</h3>

<pre class="prettyprint"><code><span class="pln">ffmpeg </span><span class="pun">-</span><span class="pln">f x11grab </span><span class="pun">-</span><span class="pln">s wxga </span><span class="pun">-</span><span class="pln">r </span><span class="lit">25</span><span class="pln"> </span><span class="pun">-</span><span class="pln">i </span><span class="pun">:</span><span class="lit">0.0</span><span class="pln"> </span><span class="pun">-</span><span class="pln">sameq </span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">mpg</span></code></pre>

<h3>33. man 妙用</h3>

<pre class="prettyprint"><code><span class="pln">man ascii
man test</span></code></pre>

<h3>34. 在 vim 中编辑上一条命令</h3>

<pre class="prettyprint"><code><span class="pln">fc </span></code></pre>

<h3>35. 删除0 字节文件或垃圾文件</h3>

<pre class="prettyprint"><code><span class="pln">find </span><span class="pun">.</span><span class="pln"> </span><span class="pun">-</span><span class="pln">type f </span><span class="pun">-</span><span class="pln">size </span><span class="lit">0</span><span class="pln"> </span><span class="pun">-</span><span class="kwd">delete</span><span class="pln">
find </span><span class="pun">.</span><span class="pln"> </span><span class="pun">-</span><span class="pln">type f </span><span class="pun">-</span><span class="kwd">exec</span><span class="pln"> rm </span><span class="pun">-</span><span class="pln">rf </span><span class="pun">{}</span><span class="pln"> \;
find </span><span class="pun">.</span><span class="pln"> </span><span class="pun">-</span><span class="pln">type f </span><span class="pun">-</span><span class="pln">name </span><span class="str">"a.out"</span><span class="pln"> </span><span class="pun">-</span><span class="kwd">exec</span><span class="pln"> rm </span><span class="pun">-</span><span class="pln">rf </span><span class="pun">{}</span><span class="pln"> \;
find </span><span class="pun">.</span><span class="pln"> type f </span><span class="pun">-</span><span class="pln">name </span><span class="str">"a.out"</span><span class="pln"> </span><span class="pun">-</span><span class="kwd">delete</span><span class="pln">
find </span><span class="pun">.</span><span class="pln"> type f </span><span class="pun">-</span><span class="pln">name </span><span class="str">"*.txt"</span><span class="pln"> </span><span class="pun">-</span><span class="pln">print0 </span><span class="pun">|</span><span class="pln"> xargs </span><span class="pun">-</span><span class="lit">0</span><span class="pln"> rm </span><span class="pun">-</span><span class="pln">f</span></code></pre>

<h3>36. 在编写SHELL 时显示多行信息</h3>

<pre class="prettyprint"><code><span class="pln">cat </span><span class="pun">&lt;&lt;</span><span class="pln"> EOF
</span><span class="pun">+--------------------------------------------------------------+</span><span class="pln">
</span><span class="pun">|</span><span class="pln"> </span><span class="pun">===</span><span class="pln"> </span><span class="typ">Welcome</span><span class="pln"> to </span><span class="typ">Tunoff</span><span class="pln"> services </span><span class="pun">===</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
</span><span class="pun">+--------------------------------------------------------------+</span><span class="pln">
EOF</span></code></pre>

<p>注意，在指定结束符时，它必须是该行的唯一内容，并且该行必须以这个字符开头。</p>

<h3>37. 如何给mysql建软链接</h3>

<pre class="prettyprint"><code><span class="pln">cd </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">mysql</span><span class="pun">/</span><span class="pln">bin
</span><span class="kwd">for</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">*</span><span class="pln">
</span><span class="kwd">do</span><span class="pln"> ln </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">mysql</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">$i </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">$i
</span><span class="kwd">done</span></code></pre>

<h3>38. 获取IP地址：</h3>

<pre class="prettyprint"><code><span class="pln">ifconfig eth0 </span><span class="pun">|</span><span class="pln">grep </span><span class="str">"inet addr:"</span><span class="pln"> </span><span class="pun">|</span><span class="pln">awk </span><span class="str">'{print $2}'</span><span class="pun">|</span><span class="pln">cut </span><span class="pun">-</span><span class="pln">c </span><span class="lit">6</span><span class="pun">-</span></code></pre>

<h3>39. 打开文件数目</h3>

<pre class="prettyprint"><code><span class="pln">lsof</span></code></pre>

<h3>40. 清除僵尸进程</h3>

<pre class="prettyprint"><code><span class="pln">ps </span><span class="pun">-</span><span class="pln">eal </span><span class="pun">|</span><span class="pln"> awk </span><span class="str">'{ if ($2 == "Z"){ print $4}}'</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> kill </span><span class="pun">-</span><span class="lit">9</span></code></pre>

<h3>41. 打印唯一行</h3>

<pre class="prettyprint"><code><span class="pln">awk </span><span class="str">'!a[$0]++'</span><span class="pln"> file</span></code></pre>

<h3>42. 打印奇数行</h3>

<pre class="prettyprint"><code><span class="pln">awk </span><span class="str">'i=!i'</span><span class="pln"> file
awk </span><span class="str">'NR%2'</span><span class="pln"> file</span></code></pre>

<h3>43. 打印匹配行后的某一行</h3>

<pre class="prettyprint"><code><span class="pln">seq </span><span class="lit">10</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> awk </span><span class="str">'/4/{f=4};--f==0{print;exit}'</span></code></pre>

<h3>44. 打印某行后后面的10行</h3>

<pre class="prettyprint"><code><span class="pln">cat file </span><span class="pun">|</span><span class="pln"> grep </span><span class="pun">-</span><span class="pln">A100 </span><span class="kwd">string</span><span class="pln">
cat file </span><span class="pun">|</span><span class="pln"> grep </span><span class="pun">-</span><span class="pln">B100 </span><span class="kwd">string</span><span class="pln"> </span><span class="com">#前面</span><span class="pln">
cat file </span><span class="pun">|</span><span class="pln"> grep </span><span class="pun">-</span><span class="pln">C100 </span><span class="kwd">string</span><span class="pln"> </span><span class="com">#前后</span><span class="pln">

sed </span><span class="pun">-</span><span class="pln">n </span><span class="str">'/string/,+100p'</span><span class="pln">

awk </span><span class="str">'/string/{f=100}--f&gt;=0'</span></code></pre>

<h3>45. 获取命令行最后一个参数</h3>

<pre class="prettyprint"><code><span class="pln">echo $</span><span class="pun">{!</span><span class="com">#}</span><span class="pln">
echo $</span><span class="pun">{</span><span class="pln">$</span><span class="com">#} #错误的尝试</span></code></pre>

<h3>46. 输出重定向</h3>

<p>如果你愿你，可以将STDERR 和 STDOUT 的输出重定向到一个输出文件，为此，bash 提供了特殊的重定向符号 &amp;&gt;</p>

<pre class="prettyprint"><code><span class="pln">ls file nofile </span><span class="pun">&amp;&gt;</span><span class="pln"> </span><span class="pun">/</span><span class="pln">dev</span><span class="pun">/</span><span class="kwd">null</span></code></pre>

<p>我们如何在脚本里面重定向呢？没有什么特别之处，和普通重定向一样。</p>

<pre class="prettyprint"><code><span class="com">#!/bin/bash</span><span class="pln">
</span><span class="com">#redirecting output to different locations</span><span class="pln">
echo </span><span class="str">"now redirecting all output to another location"</span><span class="pln"> </span><span class="pun">&amp;&gt;/</span><span class="pln">dev</span><span class="pun">/</span><span class="kwd">null</span></code></pre>

<p>问题就来了，如果我们要将所有的输出都重定向到某个文件呢？我们都不希望每次输出的时候都重定向一下吧，正所谓，山人自有妙计。我们可以用exec 来永久重定向，如下所示：</p>

<pre class="prettyprint"><code><span class="com">#!/bin/bash</span><span class="pln">
</span><span class="com">#redirecting output to different locations</span><span class="pln">
</span><span class="kwd">exec</span><span class="pln"> </span><span class="lit">2</span><span class="pun">&gt;</span><span class="pln">testerror
echo </span><span class="str">"This is the start of the script"</span><span class="pln">
echo </span><span class="str">"now redirecting all output to another location"</span><span class="pln">

</span><span class="kwd">exec</span><span class="pln"> </span><span class="lit">1</span><span class="pun">&gt;</span><span class="pln">testout
echo </span><span class="str">"This output should go to testout file"</span><span class="pln">
echo </span><span class="str">"but this should go the the testerror file"</span><span class="pln"> </span><span class="pun">&gt;&amp;</span><span class="pln"> </span><span class="lit">2</span></code></pre>

<p>输出结果如下所示：</p>

<pre class="prettyprint"><code><span class="typ">This</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> the start of the script
now redirecting all output to another location
lalor@lalor</span><span class="pun">:~/</span><span class="pln">temp$ cat testout
</span><span class="typ">This</span><span class="pln"> output should go to testout file
lalor@lalor</span><span class="pun">:~/</span><span class="pln">temp$ cat testerror
but </span><span class="kwd">this</span><span class="pln"> should go the the testerror file
lalor@lalor</span><span class="pun">:~/</span><span class="pln">temp$ </span></code></pre>

<p>以追加的方式重定向：</p>

<pre class="prettyprint"><code><span class="kwd">exec</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">&gt;&gt;</span><span class="pln"> testout</span></code></pre>

<p>取消重定向：</p>

<pre class="prettyprint"><code><span class="kwd">exec</span><span class="pln"> </span><span class="lit">3</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">-</span></code></pre>

<h3>47. 函数</h3>

<ul>
<li><p>任何地方定义的变量都是全局变量，如果要定义局部变量，需加local 关键字</p></li>
<li><p>shell中的函数也可以用递归</p>

<pre class="prettyprint"><code><span class="pln">  </span><span class="com">#!/bin/bash</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> factorial </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">[[</span><span class="pln"> $1 </span><span class="pun">-</span><span class="pln">eq </span><span class="lit">1</span><span class="pln"> </span><span class="pun">]];</span><span class="pln"> </span><span class="kwd">then</span><span class="pln">
          echo </span><span class="lit">1</span><span class="pln">
      </span><span class="kwd">else</span><span class="pln">
          </span><span class="kwd">local</span><span class="pln"> temp</span><span class="pun">=</span><span class="pln">$</span><span class="pun">[</span><span class="pln"> $1 </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">]</span><span class="pln">
          </span><span class="kwd">local</span><span class="pln"> result</span><span class="pun">=</span><span class="str">`factorial $temp`</span><span class="pln">
          echo $</span><span class="pun">[</span><span class="pln"> $result </span><span class="pun">*</span><span class="pln"> $1 </span><span class="pun">]</span><span class="pln">
      </span><span class="kwd">fi</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  result</span><span class="pun">=</span><span class="str">`factorial 5`</span><span class="pln">
  echo $result</span></code></pre></li>
<li><p>创建函数库</p>

<p>  将函数定一个在另一个文件，然后通过source 命令加载到当前文件</p></li>
<li><p>在命令行使用函数</p>

<p>  将函数定义在~/.bashrc 中即可</p></li>
<li><p>向函数传递数组</p>

<pre class="prettyprint"><code><span class="pln">  </span><span class="com">#!/bin/bash</span><span class="pln">
  </span><span class="com">#adding values in an array</span><span class="pln">

  </span><span class="kwd">function</span><span class="pln"> addarray </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">local</span><span class="pln"> sum</span><span class="pun">=</span><span class="lit">0</span><span class="pln">
      </span><span class="kwd">local</span><span class="pln"> newarray
      newarray</span><span class="pun">=(</span><span class="str">`echo "$@"`</span><span class="pun">)</span><span class="pln">
      </span><span class="kwd">for</span><span class="pln"> value </span><span class="kwd">in</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">newarray</span><span class="pun">[*]}</span><span class="pln">
      </span><span class="kwd">do</span><span class="pln">
          sum</span><span class="pun">=</span><span class="pln">$</span><span class="pun">[</span><span class="pln"> $sum</span><span class="pun">+</span><span class="pln">$value </span><span class="pun">]</span><span class="pln">
      </span><span class="kwd">done</span><span class="pln">
      echo $sum
  </span><span class="pun">}</span><span class="pln">

  myarray</span><span class="pun">=(</span><span class="lit">1</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="lit">5</span><span class="pun">)</span><span class="pln">
  echo </span><span class="str">"The original array is: ${myarray[*]}"</span><span class="pln">
  arg1</span><span class="pun">=</span><span class="str">`echo ${myarray[*]}`</span><span class="pln">
  result</span><span class="pun">=</span><span class="str">`addarray $arg1`</span><span class="pln">
  echo </span><span class="str">"The result is $result"</span></code></pre></li>
</ul>


<h2>正则表达式</h2>

<p>匹配中文字符的正则表达式：<code>[u4e00-u9fa5]</code>    <br>
评注：匹配中文还真是个头疼的事，有了这个表达式就好办了</p>

<p>匹配双字节字符(包括汉字在内)：<code>[^x00-xff]</code>    <br>
评注：可以用来计算字符串的长度（一个双字节字符长度计2，ASCII字符计1）</p>

<p>匹配空白行的正则表达式：<code>^ *$</code>    <br>
评注：可以用来删除空白行</p>

<p>匹配HTML标记的正则表达式：<code>&lt;(S*?)[^&gt;]*&gt;.*?&lt;/1&gt;|&lt;.*? /&gt;</code>    <br>
评注：网上流传的版本太糟糕，上面这个也仅仅能匹配部分，对于复杂的嵌套标记依旧无能为力</p>

<p>匹配首尾空白字符的正则表达式：<code>^s*|s*$</code>  <br>
评注：可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式</p>

<p>匹配Email地址的正则表达式：<code>w+([-+.]w+)*@w+([-.]w+)*.w+([-.]w+)*</code>  <br>
评注：表单验证时很实用</p>

<p>匹配网址URL的正则表达式：<code>[a-zA-z]+://[^s]*</code>  <br>
评注：网上流传的版本功能很有限，上面这个基本可以满足需求</p>

<p>匹配帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：<code>^[a-zA-Z][a-zA-Z0-9_]{4,15}$</code>  <br>
评注：表单验证时很实用</p>

<p>匹配国内电话号码：<code>d{3}-d{8}|d{4}-d{7}</code>  <br>
评注：匹配形式如0511-4405222或021-87888822</p>

<p>匹配腾讯QQ号：<code>[1-9][0-9]{4,}</code>  <br>
评注：腾讯QQ号从10000开始</p>

<p>匹配中国邮政编码：<code>[1-9]d{5}(?!d)</code>  <br>
评注：中国邮政编码为6位数字</p>

<p>匹配身份证：<code>d{15}|d{18}</code>  <br>
评注：中国的身份证为15位或18位</p>

<p>匹配ip地址：<code>d+.d+.d+.d+</code> <br>
评注：提取ip地址时有用</p>

<p>匹配特定数字：  <br>
<code>^[1-9]d*$</code>　　//匹配正整数  <br>
<code>^-[1-9]d*$</code>　//匹配负整数  <br>
<code>^-?[1-9]d*$</code>　　//匹配整数  <br>
<code>^[1-9]d*|0$</code>　//匹配非负整数（正整数+ 0）  <br>
<code>^-[1-9]d*|0$</code>　　//匹配非正整数（负整数+ 0）  <br>
<code>^[1-9]d*.d*|0.d*[1-9]d*$</code>　　//匹配正浮点数  <br>
<code>^-([1-9]d*.d*|0.d*[1-9]d*)$</code>　//匹配负浮点数  <br>
<code>^-?([1-9]d*.d*|0.d*[1-9]d*|0?.0+|0)$</code>　//匹配浮点数  <br>
<code>^[1-9]d*.d*|0.d*[1-9]d*|0?.0+|0$</code>　　//匹配非负浮点数（正浮点数+ 0）  <br>
<code>^(-([1-9]d*.d*|0.d*[1-9]d*))|0?.0+|0$</code>　　//匹配非正浮点数（负浮点数+ 0）  <br>
评注：处理大量数据时有用，具体应用时注意修正</p>

<p>匹配特定字符串：  <br>
<code>^[A-Za-z]+$</code>　　//匹配由26个英文字母组成的字符串  <br>
<code>^[A-Z]+$</code>　　//匹配由26个英文字母的大写组成的字符串  <br>
<code>^[a-z]+$</code>　　//匹配由26个英文字母的小写组成的字符串  <br>
<code>^[A-Za-z0-9]+$</code>　　//匹配由数字和26个英文字母组成的字符串  <br>
<code>^w+$</code>　　//匹配由数字、26个英文字母或者下划线组成的字符串</p>

</section>
