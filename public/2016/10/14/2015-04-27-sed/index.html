<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/cloud.ico?v=5.1.0" />






<meta name="description" content="sed命令####将windows文本转换为unix文本
sed -e &amp;apos;s/.$//&amp;apos; windows.txt &amp;gt; unix.xml
####删除yun.xml中包含uses的行：        sed -i ‘/uses/d’ yun.xml
####去掉” ‘ “        sed -i “s/‘//g” yun.xml
####删掉一行文字中versionCo">
<meta property="og:type" content="article">
<meta property="og:title" content="sed用法进阶篇">
<meta property="og:url" content="http://percychen.com/2016/10/14/2015-04-27-sed/index.html">
<meta property="og:site_name" content="风之子的世界">
<meta property="og:description" content="sed命令####将windows文本转换为unix文本
sed -e &amp;apos;s/.$//&amp;apos; windows.txt &amp;gt; unix.xml
####删除yun.xml中包含uses的行：        sed -i ‘/uses/d’ yun.xml
####去掉” ‘ “        sed -i “s/‘//g” yun.xml
####删掉一行文字中versionCo">
<meta property="og:updated_time" content="2016-10-14T09:44:53.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sed用法进阶篇">
<meta name="twitter:description" content="sed命令####将windows文本转换为unix文本
sed -e &amp;apos;s/.$//&amp;apos; windows.txt &amp;gt; unix.xml
####删除yun.xml中包含uses的行：        sed -i ‘/uses/d’ yun.xml
####去掉” ‘ “        sed -i “s/‘//g” yun.xml
####删掉一行文字中versionCo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 8780122,
      author: '振云'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>




  <title> sed用法进阶篇 | 风之子的世界 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=58976570";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">风之子的世界</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                sed用法进阶篇
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-14T17:23:52+08:00" content="2016-10-14">
              2016-10-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Shell/" itemprop="url" rel="index">
                    <span itemprop="name">Shell</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/14/2015-04-27-sed/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/14/2015-04-27-sed/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/10/14/2015-04-27-sed/" class="leancloud_visitors" data-flag-title="sed用法进阶篇">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="sed命令"><a href="#sed命令" class="headerlink" title="sed命令"></a>sed命令</h2><p>####将windows文本转换为unix文本</p>
<pre><code>sed -e &apos;s/.$//&apos; windows.txt &gt; unix.xml
</code></pre><p>####删除yun.xml中包含uses的行：<br>        sed -i ‘/uses/d’ yun.xml</p>
<p>####去掉” ‘ “<br>        sed -i “s/‘//g” yun.xml</p>
<p>####删掉一行文字中versionCode后面的所有文字</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i <span class="string">'s/versionCode.*//g'</span>  yun.xml</div></pre></td></tr></table></figure>
<p>####替换</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i <span class="string">'s/package: name/pkgname/g'</span>  yun.xml</div></pre></td></tr></table></figure>
<ul>
<li><p>变量替换</p>
<p>  sed -i ‘s/\’”$a”‘/\’”$b”‘/‘ c</p>
</li>
</ul>
<p>####首字母大写</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sed <span class="string">'s/\b[a-z]/\U&amp;/g'</span> <span class="built_in">test</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"aaaaa"</span>|sed <span class="string">'s/\b[a-z]/\U&amp;/g'</span></div></pre></td></tr></table></figure>
<p>####删掉空白行</p>
<pre><code>sed -i &apos;/^$/d&apos; yun.xml
</code></pre><p>####在每一行后面增加一空行</p>
<pre><code>sed G　yun.xml
</code></pre><p>####将原来的所有空行删除并在每一行后面增加一空行。</p>
<p>####这样在输出的文本中每一行后面将有且只有一空行。</p>
<pre><code>sed &apos;/^$/d;G&apos; yun.xml
</code></pre><p>###在每一行后面增加两行空行</p>
<pre><code>sed &apos;G;G&apos;
</code></pre><p>####将上一个脚本所产生的所有空行删除（即删除所有偶数行）</p>
<pre><code>sed &apos;n;d&apos;
</code></pre><p>####在匹配式样“regex”的行之前插入一空行</p>
<pre><code>sed &apos;/regex/{x;p;x;}&apos;
</code></pre><p>####在匹配式样“regex”的行之后插入一空行</p>
<pre><code>sed &apos;/regex/G&apos;
</code></pre><p>####在匹配式样“regex”的行之前和之后各插入一空行</p>
<pre><code>sed &apos;/regex/{x;p;x;G;}&apos;
</code></pre><h1 id="给文本编号"><a href="#给文本编号" class="headerlink" title="给文本编号"></a>给文本编号</h1><h4 id="为文件中的每一行进行编号（简单的左对齐方式）。这里使用了“制表符”"><a href="#为文件中的每一行进行编号（简单的左对齐方式）。这里使用了“制表符”" class="headerlink" title="为文件中的每一行进行编号（简单的左对齐方式）。这里使用了“制表符”"></a>为文件中的每一行进行编号（简单的左对齐方式）。这里使用了“制表符”</h4><h4 id="（tab，见本文末尾关于’-t’的用法的描述）而不是空格来对齐边缘。"><a href="#（tab，见本文末尾关于’-t’的用法的描述）而不是空格来对齐边缘。" class="headerlink" title="（tab，见本文末尾关于’\t’的用法的描述）而不是空格来对齐边缘。"></a>（tab，见本文末尾关于’\t’的用法的描述）而不是空格来对齐边缘。</h4><pre><code>sed = filename | sed &apos;N;s/\n/\t/&apos;
</code></pre><p>####对文件中的所有行编号（行号在左，文字右端对齐）。</p>
<pre><code>sed = filename | sed &apos;N; s/^/ /; s/ *\(.\{6,\}\)\n/\1 /&apos;
</code></pre><p>####计算行数 （模拟 “wc -l”）</p>
<pre><code>sed -n &apos;$=&apos;
</code></pre><p>文本转换和替代</p>
<p>####Unix环境：转换DOS的新行符（CR/LF）为Unix格式。</p>
<pre><code>sed &apos;s/.$//&apos; #假设所有行以CR/LF结束
sed &apos;s/^M$//&apos; # 在bash/tcsh中，将按Ctrl-M改为按Ctrl-V
sed &apos;s/\x0D$//&apos; # ssed、gsed 3.02.80，及更高版本
</code></pre><p>####Unix环境：转换Unix的新行符（LF）为DOS格式。</p>
<pre><code>sed &quot;s/$/`echo -e \\\r`/&quot; # 在ksh下所使用的命令
sed &apos;s/$&apos;&quot;/`echo \\\r`/&quot; # 在bash下所使用的命令
sed &quot;s/$/`echo \\\r`/&quot; # 在zsh下所使用的命令
sed &apos;s/$/\r/&apos; # gsed 3.02.80 及更高版本
</code></pre><p>####DOS环境：转换Unix新行符（LF）为DOS格式。</p>
<pre><code>sed &quot;s/$//&quot; # 方法 1
sed -n p # 方法 2
</code></pre><p>####将每一行前导的“空白字符”（空格，制表符）删除,使之左对齐</p>
<pre><code>sed &apos;s/^[ \t]*//&apos; # 见本文末尾关于&apos;\t&apos;用法的描述
sed -i &apos;s/^ *//&apos; yun.xml
</code></pre><p>####将每一行拖尾的“空白字符”（空格，制表符）删除</p>
<pre><code>sed &apos;s/[ \t]*$//&apos; # 见本文末尾关于&apos;\t&apos;用法的描述
</code></pre><p>####将每一行中前后空白的字符删除</p>
<pre><code>sed &apos;s/^[ \t]*//;s/[ \t]*$//&apos;
</code></pre><p>####在每一行开头处插入5个空格（使全文向右移动5个字符的位置）</p>
<pre><code>sed &apos;s/^/ /&apos;
</code></pre><p>####以79个字符为宽度，将所有文本右对齐</p>
<pre><code>sed -e :a -e &apos;s/^.\{1,78\}$/ &amp;amp;/;ta&apos; # 78个字符外加最后的一个空格
</code></pre><p>####以79个字符为宽度，使所有文本居中。在方法1中，为了让文本居中每一行的前</p>
<p>####头和后头都填充了空格。 在方法2中，在居中文本的过程中只在文本的前面填充</p>
<p>####空格，并且最终这些空格将有一半会被删除。此外每一行的后头并未填充空格。</p>
<pre><code>sed -e :a -e &apos;s/^.\{1,77\}$/ &amp;amp; /;ta&apos; # 方法1
sed -e :a -e &apos;s/^.\{1,77\}$/ &amp;amp;/;ta&apos; -e &apos;s/\( *\)\1/\1/&apos; # 方法2
</code></pre><p>####在每一行中查找字串“foo”，并将找到的“foo”替换为“bar”</p>
<pre><code>sed &apos;s/foo/bar/&apos; # 只替换每一行中的第一个“foo”字串
sed &apos;s/foo/bar/4&apos; # 只替换每一行中的第四个“foo”字串
sed &apos;s/foo/bar/g&apos; # 将每一行中的所有“foo”都换成“bar”
sed &apos;s/\(.*\)foo\(.*foo\)/\1bar\2/&apos; # 替换倒数第二个“foo”
sed &apos;s/\(.*\)foo/\1bar/&apos; # 替换最后一个“foo”
</code></pre><p>####只在行中出现字串“baz”的情况下将“foo”替换成“bar”</p>
<pre><code>sed &apos;/baz/s/foo/bar/g&apos;
</code></pre><p>####将“foo”替换成“bar”，并且只在行中未出现字串“baz”的情况下替换</p>
<pre><code>sed &apos;/baz/!s/foo/bar/g&apos;
</code></pre><p>####不管是“scarlet”“ruby”还是“puce”，一律换成“red”</p>
<pre><code>sed &apos;s/scarlet/red/g;s/ruby/red/g;s/puce/red/g&apos; #对多数的sed都有效
gsed &apos;s/scarlet\|ruby\|puce/red/g&apos; # 只对GNU sed有效
</code></pre><p>####倒置所有行，第一行成为最后一行，依次类推（模拟“tac”）。</p>
<p>####由于某些原因，使用下面命令时HHsed v1.5会将文件中的空行删除</p>
<pre><code>sed &apos;1!G;h;$!d&apos; # 方法1
sed -n &apos;1!G;h;$p&apos; # 方法2
</code></pre><p>####将行中的字符逆序排列，第一个字成为最后一字，……（模拟“rev”）</p>
<pre><code>sed &apos;/\n/!G;s/\(.\)\(.*\n\)/&amp;amp;\2\1/;//D;s/.//&apos;
</code></pre><p>####将每两行连接成一行（类似“paste”）</p>
<pre><code>sed &apos;$!N;s/\n/ /&apos;
</code></pre><p>####如果当前行以反斜杠“\”结束，则将下一行并到当前行末尾</p>
<p>####并去掉原来行尾的反斜杠</p>
<pre><code>sed -e :a -e &apos;/\\$/N; s/\\\n//; ta&apos;
</code></pre><p>####如果当前行以等号开头，将当前行并到上一行末尾</p>
<p>####并以单个空格代替原来行头的“=”</p>
<pre><code>sed -e :a -e &apos;$!N;s/\n=/ /;ta&apos; -e &apos;P;D&apos;
</code></pre><p>####为数字字串增加逗号分隔符号，将“1234567”改为“1,234,567”</p>
<pre><code>gsed &apos;:a;s/\B[0-9]\{3\}\&amp;gt;/,&amp;amp;/;ta&apos; # GNU sed
sed -e :a -e &apos;s/\(.*[0-9]\)\([0-9]\{3\}\)/\1,\2/;ta&apos; # 其他sed
</code></pre><p>####为带有小数点和负号的数值增加逗号分隔符（GNU sed）</p>
<pre><code>gsed -r &apos;:a;s/(^|[^0-9.])([0-9]+)([0-9]{3})/\1\2,\3/g;ta&apos;
</code></pre><p>####在每5行后增加一空白行 （在第5，10，15，20，等行后增加一空白行）</p>
<pre><code>gsed &apos;0~5G&apos; # 只对GNU sed有效
sed &apos;n;n;n;n;G;&apos; # 其他sed
</code></pre><h1 id="选择性地显示特定行"><a href="#选择性地显示特定行" class="headerlink" title="选择性地显示特定行"></a>选择性地显示特定行</h1><p>####显示文件中的前10行 （模拟“head”的行为）</p>
<pre><code>sed 10q
</code></pre><p>####显示文件中的第一行 （模拟“head -1”命令）</p>
<pre><code>sed q
</code></pre><p>####显示文件中的最后10行 （模拟“tail”）</p>
<pre><code>sed -e :a -e &apos;$q;N;11,$D;ba&apos;
</code></pre><p>####显示文件中的最后2行（模拟“tail -2”命令）</p>
<pre><code>sed &apos;$!N;$!D&apos;
</code></pre><p>####显示文件中的最后一行（模拟“tail -1”）</p>
<pre><code>sed &apos;$!d&apos; # 方法1
sed -n &apos;$p&apos; # 方法2
</code></pre><p>####显示文件中的倒数第二行</p>
<pre><code>sed -e &apos;$!{h;d;}&apos; -e x # 当文件中只有一行时，输入空行
sed -e &apos;1{$q;}&apos; -e &apos;$!{h;d;}&apos; -e x # 当文件中只有一行时，显示该行
sed -e &apos;1{$d;}&apos; -e &apos;$!{h;d;}&apos; -e x # 当文件中只有一行时，不输出
</code></pre><p>####只显示匹配正则表达式的行（模拟“grep”）</p>
<pre><code>sed -n &apos;/regexp/p&apos; # 方法1
sed &apos;/regexp/!d&apos; # 方法2
</code></pre><p>####只显示“不”匹配正则表达式的行（模拟“grep -v”）</p>
<pre><code>sed -n &apos;/regexp/!p&apos; # 方法1，与前面的命令相对应
sed &apos;/regexp/d&apos; # 方法2，类似的语法
</code></pre><p>####查找“regexp”并将匹配行的上一行显示出来，但并不显示匹配行</p>
<pre><code>sed -n &apos;/regexp/{g;1!p;};h&apos;
</code></pre><p>####查找“regexp”并将匹配行的下一行显示出来，但并不显示匹配行</p>
<pre><code>sed -n &apos;/regexp/{n;p;}&apos;
</code></pre><p>####显示包含“regexp”的行及其前后行，并在第一行之前加上“regexp”所</p>
<p>####在行的行号 （类似“grep -A1 -B1”）</p>
<pre><code>sed -n -e &apos;/regexp/{=;x;1!p;g;$!N;p;D;}&apos; -e h
</code></pre><p>####显示包含“AAA”、“BBB”或“CCC”的行（任意次序）</p>
<pre><code>sed &apos;/AAA/!d; /BBB/!d; /CCC/!d&apos; # 字串的次序不影响结果
</code></pre><p>####显示包含“AAA”、“BBB”和“CCC”的行（固定次序）</p>
<pre><code>sed &apos;/AAA.*BBB.*CCC/!d&apos;
</code></pre><p>####显示包含“AAA”“BBB”或“CCC”的行 （模拟“egrep”）</p>
<pre><code>sed -e &apos;/AAA/b&apos; -e &apos;/BBB/b&apos; -e &apos;/CCC/b&apos; -e d # 多数sed
gsed &apos;/AAA\|BBB\|CCC/!d&apos; # 对GNU sed有效
</code></pre><p>####显示包含“AAA”的段落 （段落间以空行分隔）</p>
<p>####HHsed v1.5 必须在“x;”后加入“G;”，接下来的3个脚本都是这样</p>
<pre><code>sed -e &apos;/./{H;$!d;}&apos; -e &apos;x;/AAA/!d;&apos;
</code></pre><p>####显示包含“AAA”“BBB”和“CCC”三个字串的段落 （任意次序）</p>
<pre><code>sed -e &apos;/./{H;$!d;}&apos; -e &apos;x;/AAA/!d;/BBB/!d;/CCC/!d&apos;
</code></pre><p>####显示包含“AAA”、“BBB”、“CCC”三者中任一字串的段落 （任意次序）</p>
<pre><code>sed -e &apos;/./{H;$!d;}&apos; -e &apos;x;/AAA/b&apos; -e &apos;/BBB/b&apos; -e &apos;/CCC/b&apos; -e d
gsed &apos;/./{H;$!d;};x;/AAA\|BBB\|CCC/b;d&apos; # 只对GNU sed有效
</code></pre><p>####显示包含65个或以上字符的行</p>
<pre><code>sed -n &apos;/^.\{65\}/p&apos;
</code></pre><p>####显示包含65个以下字符的行</p>
<pre><code>sed -n &apos;/^.\{65\}/!p&apos; # 方法1，与上面的脚本相对应
sed &apos;/^.\{65\}/d&apos; # 方法2，更简便一点的方法
</code></pre><p>####显示部分文本——从包含正则表达式的行开始到最后一行结束</p>
<pre><code>sed -n &apos;/regexp/,$p&apos;
</code></pre><p>####显示部分文本——指定行号范围（从第8至第12行，含8和12行）</p>
<pre><code>sed -n &apos;8,12p&apos; # 方法1
sed &apos;8,12!d&apos; # 方法2
</code></pre><p>####显示第52行</p>
<pre><code>sed -n &apos;52p&apos; # 方法1
sed &apos;52!d&apos; # 方法2
sed &apos;52q;d&apos; # 方法3, 处理大文件时更有效率
</code></pre><p>####从第3行开始，每7行显示一次</p>
<pre><code>gsed -n &apos;3~7p&apos; # 只对GNU sed有效
sed -n &apos;3,${p;n;n;n;n;n;n;}&apos; # 其他sed
</code></pre><p>####显示两个正则表达式之间的文本（包含）</p>
<pre><code>sed -n &apos;/Iowa/,/Montana/p&apos; # 区分大小写方式
</code></pre><h1 id="选择性地删除特定行"><a href="#选择性地删除特定行" class="headerlink" title="选择性地删除特定行"></a>选择性地删除特定行</h1><p>####显示通篇文档，除了两个正则表达式之间的内容</p>
<pre><code>sed &apos;/Iowa/,/Montana/d&apos;
</code></pre><p>####删除文件中相邻的重复行（模拟“uniq”）</p>
<p>####只保留重复行中的第一行，其他行删除</p>
<pre><code>sed &apos;$!N; /^\(.*\)\n\1$/!P; D&apos;
</code></pre><p>####删除文件中的重复行，不管有无相邻。注意hold space所能支持的缓存</p>
<p>####大小，或者使用GNU sed。</p>
<pre><code>sed -n &apos;G; s/\n/&amp;amp;&amp;amp;/; /^\([ -~]*\n\).*\n\1/d; s/\n//; h; P&apos;
</code></pre><p>####删除除重复行外的所有行（模拟“uniq -d”）</p>
<pre><code>sed &apos;$!N; s/^\(.*\)\n\1$/\1/; t; D&apos;
</code></pre><p>####删除文件中开头的10行</p>
<pre><code>sed &apos;1,10d&apos;
</code></pre><p>####删除文件中的最后一行</p>
<pre><code>sed &apos;$d&apos;
</code></pre><p>####删除文件中的最后两行</p>
<pre><code>sed &apos;N;$!P;$!D;$d&apos;
</code></pre><p>####删除文件中的最后10行</p>
<pre><code>sed -e :a -e &apos;$d;N;2,10ba&apos; -e &apos;P;D&apos; # 方法1
sed -n -e :a -e &apos;1,10!{P;N;D;};N;ba&apos; # 方法2
</code></pre><p>####删除8的倍数行</p>
<pre><code>gsed &apos;0~8d&apos; # 只对GNU sed有效
sed &apos;n;n;n;n;n;n;n;d;&apos; # 其他sed
</code></pre><p>####删除匹配式样的行</p>
<pre><code>sed &apos;/pattern/d&apos; # 删除含pattern的行。当然pattern可以换成任何有效的正则表达式
</code></pre><p>####删除文件中的所有空行（与“grep ‘.’ ”效果相同）</p>
<pre><code>sed &apos;/^$/d&apos; # 方法1
sed &apos;/./!d&apos; # 方法2
</code></pre><p>####只保留多个相邻空行的第一行。并且删除文件顶部和尾部的空行。</p>
<p>####（模拟“cat -s”）</p>
<pre><code>sed &apos;/./,/^$/!d&apos; #方法1，删除文件顶部的空行，允许尾部保留一空行
sed &apos;/^$/N;/\n$/D&apos; #方法2，允许顶部保留一空行，尾部不留空行
</code></pre><p>####只保留多个相邻空行的前两行。</p>
<pre><code>sed &apos;/^$/N;/\n$/N;//D&apos;
</code></pre><p>####删除文件顶部的所有空行</p>
<pre><code>sed &apos;/./,$!d&apos;
</code></pre><p>####删除文件尾部的所有空行</p>
<pre><code>sed -e :a -e &apos;/^\n*$/{$d;N;ba&apos; -e &apos;}&apos; # 对所有sed有效
sed -e :a -e &apos;/^\n*$/N;/\n$/ba&apos; # 同上，但只对 gsed 3.02.*有效
</code></pre><p>####删除每个段落的最后一行</p>
<pre><code>sed -n &apos;/^$/{p;h;};/./{x;/./p;}&apos;
</code></pre><h2 id="特殊应用"><a href="#特殊应用" class="headerlink" title="特殊应用"></a>特殊应用</h2><p>####移除手册页（man page）中的nroff标记。在Unix System V或bash shell下使</p>
<p>####用’echo’命令时可能需要加上 -e 选项。</p>
<pre><code>sed &quot;s/.`echo \\\b`//g&quot; # 外层的双括号是必须的（Unix环境）
sed &apos;s/.^H//g&apos; # 在bash或tcsh中, 按 Ctrl-V 再按 Ctrl-H
sed &apos;s/.\x08//g&apos; # sed 1.5，GNU sed，ssed所使用的十六进制的表示方法
</code></pre><p>####提取新闻组或 e-mail 的邮件头</p>
<pre><code>sed &apos;/^$/q&apos; # 删除第一行空行后的所有内容
</code></pre><p>####提取新闻组或 e-mail 的正文部分\</p>
<pre><code>sed &apos;1,/^$/d&apos; # 删除第一行空行之前的所有内容
</code></pre><p>####从邮件头提取“Subject”（标题栏字段），并移除开头的“Subject:”字样</p>
<pre><code>sed &apos;/^Subject: */!d; s///;q&apos;
</code></pre><p>####从邮件头获得回复地址</p>
<pre><code>sed &apos;/^Reply-To:/q; /^From:/h; /./d;g;q&apos;
</code></pre><p>####获取邮件地址。在上一个脚本所产生的那一行邮件头的基础上进一步的将非电邮</p>
<p>####地址的部分剃除。（见上一脚本）</p>
<pre><code>sed &apos;s/ *(.*)//; s/&amp;gt;.*//; s/.*[:&amp;lt;] *//&apos;
</code></pre><p>####在每一行开头加上一个尖括号和空格（引用信息）</p>
<pre><code>sed &apos;s/^/&amp;gt; /&apos;
</code></pre><p>####将每一行开头处的尖括号和空格删除（解除引用）</p>
<pre><code>sed &apos;s/^&amp;gt; //&apos;
</code></pre><p>####移除大部分的HTML标签（包括跨行标签）</p>
<pre><code>sed -e :a -e &apos;s/&amp;lt;[^&amp;gt;]*&amp;gt;//g;/
</code></pre><p>####将分成多卷的uuencode文件解码。移除文件头信息，只保留uuencode编码部分。</p>
<p>####文件必须以特定顺序传给sed。下面第一种版本的脚本可以直接在命令行下输入；</p>
<p>####第二种版本则可以放入一个带执行权限的shell脚本中。（由Rahul Dhesi的一</p>
<p>####个脚本修改而来。）</p>
<pre><code>sed &apos;/^end/,/^begin/d&apos; file1 file2 ... fileX | uudecode # vers. 1
sed &apos;/^end/,/^begin/d&apos; &quot;$@&quot; | uudecode # vers. 2
</code></pre><p>####将文件中的段落以字母顺序排序。段落间以（一行或多行）空行分隔。GNU sed使用</p>
<p>####字元“\v”来表示垂直制表符，这里用它来作为换行符的占位符——当然你也可以</p>
<p>####用其他未在文件中使用的字符来代替它。</p>
<pre><code>sed &apos;/./{H;d;};x;s/\n/={NL}=/g&apos; file | sort | sed &apos;1s/={NL}=//;s/={NL}=/\n/g&apos;
gsed &apos;/./{H;d};x;y/\n/\v/&apos; file | sort | sed &apos;1s/\v//;y/\v/\n/&apos;
</code></pre><p>####分别压缩每个.TXT文件，压缩后删除原来的文件并将压缩后的.ZIP文件</p>
<p>####命名为与原来相同的名字（只是扩展名不同）。（DOS环境：“dir /b”</p>
<p>####显示不带路径的文件名）。</p>
<pre><code>echo @echo off &amp;gt;zipup.bat
dir /b *.txt | sed &quot;s/^\(.*\)\.TXT/pkzip -mo \1 \1.TXT/&quot; &amp;gt;&amp;gt;zipup.bat
</code></pre><p>＞　使 用SED：Sed接受一个或多个编辑命令，并且每读入一行后就依次应用这些命令。当读入第一行输入后，sed对其应用所有的命令，然后将结果输出。接着再<br><br>＞　读入第二行输入，对其应用所有的命令……并重复这个过程。上一个例子中sed由标准输入设备（即命令解释器，通常是以管道输入的形式）获得输入。在命令行<br> ＞　给出一个或多个文件名作为参数时，这些文件取代标准输入设备成为sed的输入。sed的输出将被送到标准输出（显示器）。因此：</p>
<pre><code>cat filename | sed &apos;10q&apos;         # 使用管道输入
sed &apos;10q&apos; filename                 # 同样效果，但不使用管道输入
sed &apos;10q&apos; filename &amp;gt; newfile     # 将输出转移（重定向）到磁盘上
</code></pre><p>要 了解sed命令的使用说明，包括如何通过脚本文件（而非从命令行）来使用这些命令，请参阅《sed &amp; awk》第二版，作者Dale Dougherty和Arnold <br> Robbins（O’Reilly，1997；<a href="http://www.ora.com），《UNIX" target="_blank" rel="external">http://www.ora.com），《UNIX</a> Text Processing》，作者Dale Dougherty和Tim O’Reilly（Hayden Books，1987）或者是Mike <br> Arst写的教程——压缩包的名称是“U-SEDIT2.ZIP”（在许多站点上都找得到）。要发掘sed的潜力，则必须对“正则表达式”有足够的理解。<br><br> 正则表达式的资料可以看《Mastering Regular Expressions》作者Jeffrey Friedl（O’reilly 1997）。<br><br> Unix系统所提供的手册页（“man”）也会有所帮助（试一下这些命令“man sed”、“man regexp”，或者看“man <br> ed”中关于正则表达式的部分），但手册提供的信息比较“抽象”——这也是它一直为人所诟病的。<br><br> 不过，它本来就不是用来教初学者如何使用sed或正则表达 式的教材，而只是为那些熟悉这些工具的人提供的一些文本参考。<br><br><br></p>
<h2 id="括号语法："><a href="#括号语法：" class="headerlink" title="括号语法："></a>括号语法：</h2><p>前面的例子对sed命令基本上都使用单引号（’…’）而非双 <br> 引号（”…”）这是因为sed通常是在Unix平台上使用。单引号下，Unix的shell（命令解释器）不会对美元符（$）和后引号（<code>...</code>） <br> 进行解释和执行。而在双引号下美元符会被展开为变量或参数的值，后引号中的命令被执行并以输出的结果代替后引号中的内容。而在“csh”及其衍生的 <br> shell中使用感叹号（!）时需要在其前面加上转义用的反斜杠（就像这样：!）以保证上面所使用的例子能正常运行（包括使用单引号的情况下）。DOS <br> 版本的Sed则一律使用双引号（”…”）而不是引号来圈起命令。<br></p>
<h2 id="‘-t’的用法："><a href="#‘-t’的用法：" class="headerlink" title="‘\t’的用法："></a>‘\t’的用法：</h2><p>为了使本文保持行文简洁，我们在脚本中使用’\t’ <br> 来表示一个制表符。但是现在大部分版本的sed还不能识别’\t’的简写方式，因此当在命令行中为脚本输入制表符时，你应该直接按TAB键来输入制表符而 <br> 不是输入’\t’。下列的工具软件都支持’\t’做为一个正则表达式的字元来表示制表符：awk、perl、HHsed、sedmod以及GNU sed v3.02.80。<br></p>
<h2 id="不同版本的SED："><a href="#不同版本的SED：" class="headerlink" title="不同版本的SED："></a>不同版本的SED：</h2><p>不同的版本间的sed会有些不同之处，可以想象它们之间在语法上会有差异。具体而言，它们 中大部分不支持在编辑命令中间使用标签（:name）或<br><br>分支命令（b,t），除非是放在那些的末尾。这篇文档中我们尽量选用了可移植性较高的语法，以使大 <br> 多数版本的sed的用户都能使用这些脚本。不过GNU版本的sed允许使用更简洁的语法。想像一下当读者看到一个很长的命令时的心情：<br></p>
<pre><code>sed -e &apos;/AAA/b&apos; -e &apos;/BBB/b&apos; -e &apos;/CCC/b&apos; -e d
</code></pre><p>好消息是GNU sed能让命令更紧凑：</p>
<pre><code>sed &apos;/AAA/b;/BBB/b;/CCC/b;d&apos;         # 甚至可以写成
sed &apos;/AAA\|BBB\|CCC/b;d&apos;
</code></pre><p>此外，请注意虽然许多版本的sed接受象“/one/ s/RE1/RE2/”这种在’s’前带有空格的命令，但这些版本中有些却不接受这样的命令:“/one/! s/RE1/RE2/”。这时只需要把中间的空格去掉就行了。</p>
<p>速度优化：当由于某种原因（比如输入文件较大、处理器或硬盘较慢等）需要提高命令执行速度时，可以考虑在替换命令（“s/…/…/”）前面加上地址表达式来提高速度。举例来说：</p>
<pre><code>sed &apos;s/foo/bar/g&apos; filename         # 标准替换命令
sed &apos;/foo/ s/foo/bar/g&apos; filename     # 速度更快
sed &apos;/foo/ s//bar/g&apos; filename         # 简写形式
</code></pre><p>当只需要显示文件的前面的部分或需要删除后面的内容时，可以在脚本中使用“q”<br>命令（退出命令）。在处理大的文件时，这会节省大量时间。因此：</p>
<pre><code>sed -n &apos;45,50p&apos; filename             # 显示第45到50行
sed -n &apos;51q;45,50p&apos; filename         # 一样，但快得多
</code></pre><p>如 果你有其他的单行脚本想与大家分享或者你发现了本文档中错误的地方，请发电子邮件给本文档的作者（Eric Pement）。邮件中请记得提供你所使用的sed版本、 该sed所运行的操作系统及对问题的适当描述。本文所指的单行脚本指命令行的长度在65个字符或65个以下的sed脚本〔译注1〕。本文档的各种脚本是由 以下所列作者所写或提供：</p>
<pre><code>Al Aab # 建立了“seders”邮件列表
Edgar Allen # 许多方面
Yiorgos Adamopoulos # 许多方面
Dale Dougherty # 《sed &amp;amp; awk》作者
Carlos Duarte # 《do it with sed》作者
Eric Pement # 本文档的作者
Ken Pizzini # GNU sed v3.02 的作者
S.G. Ravenhall # 去html标签脚本
Greg Ubben # 有诸多贡献并提供了许多帮助
-------------------------------------------------------------------------
</code></pre><p>译 注1：大部分情况下，sed脚本无论多长都能写成单行的形式（通过<code>-e&#39;选项和</code>;’号）——只要命令解释器支持，所以这里说的单行脚本除了能写成一行 还对长度有所限制。因为这些单行脚本的意义不在于它们是以单行的形式出现。而是让用户能方便地在命令行中使用这些紧凑的脚本才是其意义所在。</p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/10/14/2015-04-29-sparse_systemimage/" rel="next" title="system.img的分解与合并">
                <i class="fa fa-chevron-left"></i> system.img的分解与合并
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/10/14/2015-04-15-ShellExpandNote/" rel="prev" title="shell 补漏笔记">
                shell 补漏笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/10/14/2015-04-27-sed/"
     data-title="sed用法进阶篇"
     data-content=""
     data-url="http://percychen.com/2016/10/14/2015-04-27-sed/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/10/14/2015-04-27-sed/"
           data-title="sed用法进阶篇" data-url="http://percychen.com/2016/10/14/2015-04-27-sed/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/yunicon.png"
               alt="percy|振云" />
          <p class="site-author-name" itemprop="name">percy|振云</p>
          <p class="site-description motion-element" itemprop="description">愿我从此不再提起，再不提起过去，痛苦与幸福</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">135</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">39</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/yunpercy" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/yun-percy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://user.qzone.qq.com/464095417" target="_blank" title="QQ空间">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  QQ空间
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              友情链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://xiangsunzi.com/" title="生活与小怪兽" target="_blank">生活与小怪兽</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#sed命令"><span class="nav-number">1.</span> <span class="nav-text">sed命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#给文本编号"><span class="nav-number"></span> <span class="nav-text">给文本编号</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#为文件中的每一行进行编号（简单的左对齐方式）。这里使用了“制表符”"><span class="nav-number">0.0.1.</span> <span class="nav-text">为文件中的每一行进行编号（简单的左对齐方式）。这里使用了“制表符”</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#（tab，见本文末尾关于’-t’的用法的描述）而不是空格来对齐边缘。"><span class="nav-number">0.0.2.</span> <span class="nav-text">（tab，见本文末尾关于’\t’的用法的描述）而不是空格来对齐边缘。</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#选择性地显示特定行"><span class="nav-number"></span> <span class="nav-text">选择性地显示特定行</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#选择性地删除特定行"><span class="nav-number"></span> <span class="nav-text">选择性地删除特定行</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#特殊应用"><span class="nav-number">1.</span> <span class="nav-text">特殊应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#括号语法："><span class="nav-number">2.</span> <span class="nav-text">括号语法：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#‘-t’的用法："><span class="nav-number">3.</span> <span class="nav-text">‘\t’的用法：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不同版本的SED："><span class="nav-number">4.</span> <span class="nav-text">不同版本的SED：</span></a></li></ol></div>
            

          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">percy|振云</span>
</div>

<div class="powered-by">
  由 percy 先生维护制作
</div>

<div class="theme-info">
  关于 -
  <a class="theme-link" href="http://percychen.com">
    percy先生
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"percychen"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js?v=5.1.0"></script>
    
  






  
  
  
  <script type="text/javascript">
    $(document).ready(function () {
      if ( $('#local-search-input').size() === 0) {
        return;
      }

      // Popup Window;
      var isfetched = false;
      // Search DB path;
      var search_path = "search.xml";
      if (search_path.length == 0) {
        search_path = "search.xml";
      }
      var path = "/" + search_path;
      // monitor main search box;

      function proceedsearch() {
        $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
        $('.popup').toggle();

      }
      // search function;
      var searchFunc = function(path, search_id, content_id) {
        'use strict';
        $.ajax({
          url: path,
          dataType: "xml",
          async: true,
          success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
              return {
                title: $( "title", this ).text(),
                content: $("content",this).text(),
                url: $( "url" , this).text()
              };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
              var matchcounts = 0;
              var str='<ul class=\"search-result-list\">';
              var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
              $resultContent.innerHTML = "";
              if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                  var isMatch = true;
                  var content_index = [];
                  var data_title = data.title.trim().toLowerCase();
                  var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                  var data_url = data.url;
                  var index_title = -1;
                  var index_content = -1;
                  var first_occur = -1;
                  // only match artiles with not empty titles and contents
                  if(data_title != '' && data_content != '') {
                    keywords.forEach(function(keyword, i) {
                      index_title = data_title.indexOf(keyword);
                      index_content = data_content.indexOf(keyword);
                      if( index_title < 0 && index_content < 0 ){
                        isMatch = false;
                      } else {
                        if (index_content < 0) {
                          index_content = 0;
                        }
                        if (i == 0) {
                          first_occur = index_content;
                        }
                      }
                    });
                  }
                  // show search results
                  if (isMatch) {
                    matchcounts += 1;
                    str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                    var content = data.content.trim().replace(/<[^>]+>/g,"");
                    if (first_occur >= 0) {
                      // cut out 100 characters
                      var start = first_occur - 20;
                      var end = first_occur + 80;
                      if(start < 0){
                        start = 0;
                      }
                      if(start == 0){
                        end = 50;
                      }
                      if(end > content.length){
                        end = content.length;
                      }
                      var match_content = content.substring(start, end);
                      // highlight all keywords
                      keywords.forEach(function(keyword){
                        var regS = new RegExp(keyword, "gi");
                        match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                      });

                      str += "<p class=\"search-result\">" + match_content +"...</p>"
                    }
                    str += "</li>";
                  }
                })};
              str += "</ul>";
              if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
              if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
              $resultContent.innerHTML = str;
            });
            proceedsearch();
          }
        });}

      // handle and trigger popup window;
      $('.popup-trigger').mousedown(function(e) {
        e.stopPropagation();
        if (isfetched == false) {
          searchFunc(path, 'local-search-input', 'local-search-result');
        } else {
          proceedsearch();
        };

      });

      $('.popup-btn-close').click(function(e){
        $('.popup').hide();
        $(".popoverlay").remove();
        $('body').css('overflow', '');
      });
      $('.popup').click(function(e){
        e.stopPropagation();
      });
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("7d74DeOPOEXkqoHL2A6jD1Ov-gzGzoHsz", "UU5DcLV69esGTGlJCglVXSiE");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
  


</body>
</html>
